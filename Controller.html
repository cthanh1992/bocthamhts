<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Controller - Lucky Draw</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
        --gold: #FFD700;
        --gold-dark: #B8860B;
        --red-start: #ff0000;
        --red-end: #990000;
    }

    body { 
        background-color: #0a0a14;
        background-image: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
        display: flex; 
        flex-direction: column;
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
        margin: 0; 
        font-family: 'Montserrat', sans-serif;
        overflow: hidden; /* Chặn cuộn trang trên iPad */
        touch-action: manipulation; /* Tăng tốc độ phản hồi cảm ứng */
    }

    /* Vòng tròn trang trí bên ngoài */
    .btn-wrapper {
        position: relative;
        padding: 10px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--gold), var(--gold-dark));
        box-shadow: 0 0 60px rgba(255, 215, 0, 0.3);
        animation: pulse-gold 2s infinite;
    }

    .btn {
        width: 320px; 
        height: 320px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ff4d4d, #990000);
        border: 4px solid rgba(255,255,255,0.2);
        color: white; 
        cursor: pointer;
        display: flex; 
        flex-direction: column; 
        justify-content: center; 
        align-items: center;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        box-shadow: 
            inset 0 10px 20px rgba(255,255,255,0.3), /* Highlight trên */
            inset 0 -10px 20px rgba(0,0,0,0.5), /* Bóng đổ trong */
            0 15px 30px rgba(0,0,0,0.6); /* Bóng đổ ngoài */
        transition: all 0.1s;
        position: relative;
        z-index: 10;
        outline: none;
        -webkit-tap-highlight-color: transparent;
    }

    /* Chữ chính */
    .btn-text-main {
        font-size: 50px;
        font-weight: 900;
        letter-spacing: 2px;
        text-transform: uppercase;
    }

    /* Chữ phụ */
    .btn-text-sub {
        font-size: 14px;
        font-weight: 600;
        margin-top: 5px;
        color: rgba(255,255,255,0.8);
        text-transform: uppercase;
    }

    /* Trạng thái khi bấm */
    .btn:active { 
        transform: scale(0.96) translateY(5px); 
        background: radial-gradient(circle at 30% 30%, #cc0000, #660000);
        box-shadow: 
            inset 0 5px 10px rgba(0,0,0,0.8), 
            0 5px 10px rgba(0,0,0,0.4);
    }

    /* Trạng thái Disable (Đang quay) */
    .btn:disabled {
        background: #333;
        border-color: #555;
        color: #777;
        box-shadow: none;
        transform: scale(0.95);
        cursor: not-allowed;
        animation: none;
    }
    
    .btn:disabled .btn-text-sub { color: #555; }
    
    /* Vòng tròn bao ngoài khi disable cũng xám đi */
    .btn-wrapper.disabled-wrapper {
        background: #444;
        animation: none;
        box-shadow: none;
    }

    .status { 
        color: var(--gold); 
        margin-top: 40px; 
        font-size: 18px;
        font-weight: 600;
        letter-spacing: 1px;
        text-transform: uppercase;
        text-align: center;
        min-height: 25px;
    }

    /* Hiệu ứng nhịp thở cho viền vàng */
    @keyframes pulse-gold {
        0% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.2); transform: scale(1); }
        50% { box-shadow: 0 0 60px rgba(255, 215, 0, 0.6); transform: scale(1.02); }
        100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.2); transform: scale(1); }
    }

    /* Điều chỉnh cho màn hình nhỏ (điện thoại) */
    @media (max-width: 400px) {
        .btn { width: 260px; height: 260px; }
        .btn-text-main { font-size: 40px; }
    }
  </style>
</head>
<body>

<div class="btn-wrapper" id="btnWrapper">
    <button class="btn" id="spinBtn" onclick="trigger()">
      <div class="btn-text-main">QUAY</div>
      <div class="btn-text-sub">CHẠM ĐỂ BẮT ĐẦU</div>
    </button>
</div>

<div class="status" id="msg">SẴN SÀNG KẾT NỐI</div>

<script>
  function trigger() {
    var btn = document.getElementById('spinBtn');
    var wrapper = document.getElementById('btnWrapper');
    var msg = document.getElementById('msg');
    
    // UI Feedback ngay lập tức
    msg.innerText = "ĐANG GỬI TÍN HIỆU...";
    btn.disabled = true;
    wrapper.classList.add('disabled-wrapper');
    btn.innerHTML = '<div class="btn-text-main" style="font-size:30px">ĐANG QUAY...</div>';

    // Rung phản hồi (Haptic Feedback) nếu thiết bị hỗ trợ (Android)
    if (navigator.vibrate) navigator.vibrate(50);

    google.script.run.withSuccessHandler(function(res){
      msg.innerText = "✅ ĐÃ KÍCH HOẠT THÀNH CÔNG!";
      
      // Khóa nút trong 5 giây (hoặc theo thời gian giải) để tránh bấm đúp
      setTimeout(() => {
         btn.style.background = ""; // Reset background gradient
         btn.disabled = false;
         wrapper.classList.remove('disabled-wrapper');
         
         btn.innerHTML = '<div class="btn-text-main">QUAY</div><div class="btn-text-sub">LƯỢT TIẾP THEO</div>';
         msg.innerText = "SẴN SÀNG";
         
         // Rung nhẹ báo hiệu sẵn sàng
         if (navigator.vibrate) navigator.vibrate([30, 30, 30]);
      }, 5000); // 5 giây sau nút mới sáng lại
    }).triggerSpin();
  }
</script>
</body>
</html>
